(()=>{var e={};e.id=513,e.ids=[513],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41098:(e,r,t)=>{"use strict";t.d(r,{_d:()=>o,aP:()=>u});var s=t(96330),a=t(43205);let i=new s.PrismaClient,n=process.env.JWT_SECRET||"your-secret-key-change-in-production";async function o(e){try{let r=null,t=e.cookies.get("auth_token");if(t&&(r=t.value),!r){let t=e.headers.get("Authorization");t?.startsWith("Bearer ")&&(r=t.substring(7))}if(!r)return{success:!1,error:"Authentication required"};let s=(0,a.verify)(r,n),o=await i.user.findUnique({where:{id:s.id},include:{}});if(!o)return{success:!1,error:"User not found"};if(o&&!1===o.active)return{success:!1,error:"User account is inactive"};return await i.user.update({where:{id:o.id},data:{lastLogin:new Date}}),{success:!0,user:o}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Invalid or expired token"}}}function u(e){return Buffer.from(`${e}-${Date.now()}-${Math.random()}`).toString("base64")}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46276:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>p});var a=t(96559),i=t(48088),n=t(37719),o=t(32190),u=t(96330),c=t(41098);let d=new u.PrismaClient;async function p(e){try{let r=await (0,c._d)(e);if(!r.success)return o.NextResponse.json({error:r.error},{status:401});if(!["ADMIN","SUPER_ADMIN"].includes(r.user.role))return o.NextResponse.json({error:"Unauthorized"},{status:403});let t=new URL(e.url),s=parseInt(t.searchParams.get("page")||"1"),a=parseInt(t.searchParams.get("limit")||"20"),i=t.searchParams.get("action")||void 0,n=t.searchParams.get("entityType")||void 0,u=t.searchParams.get("entityId")||void 0,p=t.searchParams.get("userId")||void 0,l=t.searchParams.get("startDate")||void 0,g=t.searchParams.get("endDate")||void 0;if(isNaN(s)||s<1)return o.NextResponse.json({error:"Invalid page parameter"},{status:400});if(isNaN(a)||a<1||a>100)return o.NextResponse.json({error:"Invalid limit parameter"},{status:400});let m={};i&&(m.action=i),n&&(m.entityType=n),u&&(m.entityId=u),p&&(m.performedById=p),(l||g)&&(m.createdAt={},l&&(m.createdAt.gte=new Date(l)),g&&(m.createdAt.lte=new Date(g)));let h=await d.auditLog.count({where:m}),f=(s-1)*a,x=Math.ceil(h/a),v=await d.auditLog.findMany({where:m,orderBy:{createdAt:"desc"},skip:f,take:a,include:{performedBy:{select:{id:!0,name:!0,email:!0}}}});return o.NextResponse.json({auditLogs:v,pagination:{total:h,page:s,limit:a,pages:x}})}catch(e){return console.error("Error fetching audit logs:",e),o.NextResponse.json({error:"Failed to fetch audit logs"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/audit-logs/route",pathname:"/api/audit-logs",filename:"route",bundlePath:"app/api/audit-logs/route"},resolvedPagePath:"/Users/mulsewsmba/Downloads/the.RAM.plc/app/api/audit-logs/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:m,serverHooks:h}=l;function f(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:m})}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[719,580,205],()=>t(46276));module.exports=s})();