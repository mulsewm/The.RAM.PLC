(()=>{var e={};e.id=177,e.ids=[177],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41098:(e,t,r)=>{"use strict";r.d(t,{_d:()=>o,aP:()=>u});var s=r(96330),n=r(43205);let i=new s.PrismaClient,a=process.env.JWT_SECRET||"your-secret-key-change-in-production";async function o(e){try{let t=null,r=e.cookies.get("auth_token");if(r&&(t=r.value),!t){let r=e.headers.get("Authorization");r?.startsWith("Bearer ")&&(t=r.substring(7))}if(!t)return{success:!1,error:"Authentication required"};let s=(0,n.verify)(t,a),o=await i.user.findUnique({where:{id:s.id},include:{}});if(!o)return{success:!1,error:"User not found"};if(o&&!1===o.active)return{success:!1,error:"User account is inactive"};return await i.user.update({where:{id:o.id},data:{lastLogin:new Date}}),{success:!0,user:o}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Invalid or expired token"}}}function u(e){return Buffer.from(`${e}-${Date.now()}-${Math.random()}`).toString("base64")}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>f,serverHooks:()=>w,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>y});var n=r(96559),i=r(48088),a=r(37719),o=r(32190),u=r(96330),c=r(45697),d=r(41098);let p=new u.PrismaClient,g=c.z.object({key:c.z.string().min(1,"Key is required"),value:c.z.string().min(1,"Value is required"),description:c.z.string().optional(),category:c.z.string().min(1,"Category is required")});async function l(e){try{let t=await (0,d._d)(e);if(!t.success)return o.NextResponse.json({error:t.error},{status:401});let r=new URL(e.url).searchParams.get("category")||void 0,s={};r&&(s.category=r);let n=(await p.settings.findMany({where:s,orderBy:[{category:"asc"},{key:"asc"}]})).reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return await p.auditLog.create({data:{action:"settings.list",entityType:"Settings",entityId:"multiple",performedBy:{connect:{id:t.user.id}},details:JSON.stringify({category:r}),ipAddress:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),o.NextResponse.json({settings:n})}catch(e){return console.error("Error fetching settings:",e),o.NextResponse.json({error:"Failed to fetch settings"},{status:500})}}async function y(e){try{let t=await (0,d._d)(e);if(!t.success)return o.NextResponse.json({error:t.error},{status:401});if(!["ADMIN","SUPER_ADMIN"].includes(t.user.role))return o.NextResponse.json({error:"Unauthorized"},{status:403});let r=await e.json(),s=g.safeParse(r);if(!s.success)return o.NextResponse.json({error:s.error.errors},{status:400});let{key:n,value:i,description:a,category:u}=s.data;if(await p.settings.findUnique({where:{key:n}}))return o.NextResponse.json({error:"Setting with this key already exists"},{status:409});let c=await p.settings.create({data:{key:n,value:i,description:a,category:u}});return await p.auditLog.create({data:{action:"settings.create",entityType:"Settings",entityId:c.id,performedBy:{connect:{id:t.user.id}},details:JSON.stringify({key:c.key,category:c.category,description:c.description}),ipAddress:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),o.NextResponse.json(c,{status:201})}catch(e){return console.error("Error creating setting:",e),o.NextResponse.json({error:"Failed to create setting"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/settings/route",pathname:"/api/settings",filename:"route",bundlePath:"app/api/settings/route"},resolvedPagePath:"/Users/mulsewsmba/Downloads/the.RAM.plc/app/api/settings/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:w}=f;function m(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580,697,205],()=>r(63212));module.exports=s})();