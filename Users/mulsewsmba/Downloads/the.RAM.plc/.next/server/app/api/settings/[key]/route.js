(()=>{var e={};e.id=925,e.ids=[925],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6649:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>w,serverHooks:()=>k,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{DELETE:()=>f,GET:()=>g,PUT:()=>y});var n=r(96559),i=r(48088),o=r(37719),a=r(32190),u=r(96330),d=r(45697),c=r(41098);let p=new u.PrismaClient,l=d.z.object({value:d.z.string().min(1,"Value is required"),description:d.z.string().optional(),category:d.z.string().optional()});async function g(e,{params:t}){try{let r=await (0,c._d)(e);if(!r.success)return a.NextResponse.json({error:r.error},{status:401});let s=await p.settings.findUnique({where:{key:t.key}});if(!s)return a.NextResponse.json({error:"Setting not found"},{status:404});return await p.auditLog.create({data:{action:"settings.view",entityType:"Settings",entityId:s.id,performedBy:{connect:{id:r.user.id}},ipAddress:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),a.NextResponse.json(s)}catch(e){return console.error("Error fetching setting:",e),a.NextResponse.json({error:"Failed to fetch setting"},{status:500})}}async function y(e,{params:t}){try{let r=await (0,c._d)(e);if(!r.success)return a.NextResponse.json({error:r.error},{status:401});if(!["ADMIN","SUPER_ADMIN"].includes(r.user.role))return a.NextResponse.json({error:"Unauthorized"},{status:403});let s=await e.json(),n=l.safeParse(s);if(!n.success)return a.NextResponse.json({error:n.error.errors},{status:400});let i=n.data,o=await p.settings.findUnique({where:{key:t.key}});if(!o)return a.NextResponse.json({error:"Setting not found"},{status:404});await p.settingsChange.create({data:{setting:{connect:{id:o.id}},previousValue:o.value,newValue:i.value,changedBy:{connect:{id:r.user.id}}}});let u=await p.settings.update({where:{key:t.key},data:i});return await p.auditLog.create({data:{action:"settings.update",entityType:"Settings",entityId:u.id,performedBy:{connect:{id:r.user.id}},details:JSON.stringify({key:t.key,previousValue:o.value,newValue:u.value,category:u.category}),ipAddress:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),a.NextResponse.json(u)}catch(e){return console.error("Error updating setting:",e),a.NextResponse.json({error:"Failed to update setting"},{status:500})}}async function f(e,{params:t}){try{let r=await (0,c._d)(e);if(!r.success)return a.NextResponse.json({error:r.error},{status:401});if("SUPER_ADMIN"!==r.user.role)return a.NextResponse.json({error:"Unauthorized"},{status:403});let s=await p.settings.findUnique({where:{key:t.key}});if(!s)return a.NextResponse.json({error:"Setting not found"},{status:404});return await p.settings.delete({where:{key:t.key}}),await p.auditLog.create({data:{action:"settings.delete",entityType:"Settings",entityId:s.id,performedBy:{connect:{id:r.user.id}},details:JSON.stringify({key:t.key,category:s.category,value:s.value}),ipAddress:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),a.NextResponse.json({message:"Setting deleted successfully"})}catch(e){return console.error("Error deleting setting:",e),a.NextResponse.json({error:"Failed to delete setting"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/settings/[key]/route",pathname:"/api/settings/[key]",filename:"route",bundlePath:"app/api/settings/[key]/route"},resolvedPagePath:"/Users/mulsewsmba/Downloads/the.RAM.plc/app/api/settings/[key]/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:k}=w;function v(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41098:(e,t,r)=>{"use strict";r.d(t,{_d:()=>a,aP:()=>u});var s=r(96330),n=r(43205);let i=new s.PrismaClient,o=process.env.JWT_SECRET||"your-secret-key-change-in-production";async function a(e){try{let t=null,r=e.cookies.get("auth_token");if(r&&(t=r.value),!t){let r=e.headers.get("Authorization");r?.startsWith("Bearer ")&&(t=r.substring(7))}if(!t)return{success:!1,error:"Authentication required"};let s=(0,n.verify)(t,o),a=await i.user.findUnique({where:{id:s.id},include:{}});if(!a)return{success:!1,error:"User not found"};if(a&&!1===a.active)return{success:!1,error:"User account is inactive"};return await i.user.update({where:{id:a.id},data:{lastLogin:new Date}}),{success:!0,user:a}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Invalid or expired token"}}}function u(e){return Buffer.from(`${e}-${Date.now()}-${Math.random()}`).toString("base64")}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580,697,205],()=>r(6649));module.exports=s})();