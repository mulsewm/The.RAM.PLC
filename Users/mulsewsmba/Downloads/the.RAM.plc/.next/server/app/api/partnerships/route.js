(()=>{var e={};e.id=309,e.ids=[309],e.modules={6377:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>I,routeModule:()=>x,serverHooks:()=>A,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{GET:()=>f,POST:()=>R});var a=s(96559),n=s(48088),i=s(37719),o=s(45697),c=s(96330),m=s(79464);class u extends Error{constructor(e,t,s){super(t),this.status=e,this.details=s,this.name="ApiError"}}let p={paginated:(e,{page:t,limit:s,total:r})=>({success:!0,data:e,meta:{page:t,limit:s,total:r,totalPages:Math.ceil(r/s),hasNextPage:t*s<r,hasPreviousPage:t>1}})},l=(e,t)=>({skip:(e-1)*t,take:t}),d=new Map,y=(e,t,s=6e4)=>{let r=Date.now(),a=d.get(e);return!a||a.resetTime<r?(d.set(e,{count:1,resetTime:r+s}),{success:!0,remaining:t-1}):a.count>=t?{success:!1,error:"Too many requests",retryAfter:Math.ceil((a.resetTime-r)/1e3)}:(a.count++,{success:!0,remaining:t-a.count})},g=o.z.object({status:o.z.nativeEnum(c.Status).optional(),country:o.z.string().min(2).optional(),businessType:o.z.string().min(2).optional(),search:o.z.string().optional(),page:o.z.string().regex(/^\d+$/).default("1").transform(Number),limit:o.z.string().regex(/^\d+$/).default("10").transform(Number)}),h=o.z.object({fullName:o.z.string().min(2,{message:"Full name must be at least 2 characters"}).max(100,{message:"Full name must be at most 100 characters"}).trim(),email:o.z.string().email({message:"Invalid email address"}).max(100,{message:"Email must be at most 100 characters"}).toLowerCase().trim(),company:o.z.string().min(2,{message:"Company name must be at least 2 characters"}).max(100,{message:"Company name must be at most 100 characters"}).trim(),phone:o.z.string().min(5,{message:"Phone number must be at least 5 characters"}).max(20,{message:"Phone number must be at most 20 characters"}).regex(/^[+\d\s-]+$/,{message:"Invalid phone number format"}).trim(),country:o.z.string().min(2,{message:"Country must be at least 2 characters"}).max(100,{message:"Country must be at most 100 characters"}).trim(),expertise:o.z.array(o.z.string()).min(1,{message:"At least one area of expertise must be selected"}).max(10,{message:"Maximum 10 expertise areas allowed"}),businessType:o.z.string().min(2,{message:"Business type must be at least 2 characters"}).max(100,{message:"Business type must be at most 100 characters"}).trim(),message:o.z.string().max(2e3,{message:"Message must be at most 2000 characters"}).optional().default(""),termsAccepted:o.z.boolean().refine(e=>!0===e,{message:"You must accept the terms and conditions"})}),f=async e=>{try{let t=e.headers.get("x-forwarded-for"),s=t?t.split(/, /)[0]:"127.0.0.1",r=y(s,10);if(!r.success)return new Response(JSON.stringify({error:r.error||"Rate limit exceeded",retryAfter:r.retryAfter}),{status:429,headers:{"Content-Type":"application/json","Retry-After":r.retryAfter?.toString()||"60","X-RateLimit-Limit":"10","X-RateLimit-Remaining":r.remaining?.toString()||"0","X-RateLimit-Reset":(Math.floor(Date.now()/1e3)+(r.retryAfter||60)).toString()}});let a=Object.fromEntries(e.nextUrl.searchParams),n=g.safeParse(a);if(!n.success)throw new u(400,"Invalid query parameters",n.error.flatten());let{status:i,country:o,businessType:c,search:d,page:h,limit:f}=n.data,{skip:R,take:x}=l(h,f),w={};i&&(w.status=i),o&&(w.country=o),c&&(w.businessType=c),d&&(w.OR=[{fullName:{contains:d,mode:"insensitive"}},{email:{contains:d,mode:"insensitive"}},{company:{contains:d,mode:"insensitive"}}]);let b=await m.z.partnershipApplication.count({where:w}),A=await m.z.partnershipApplication.findMany({skip:R,take:x,where:w,orderBy:{createdAt:"desc"},include:{statusHistory:{include:{changedBy:{select:{id:!0,name:!0,email:!0}}},orderBy:{changedAt:"desc"},take:1},notes:{include:{createdBy:{select:{id:!0,name:!0,email:!0}}},orderBy:{createdAt:"desc"}},attachments:{include:{uploadedBy:{select:{id:!0,name:!0,email:!0}}},orderBy:{uploadedAt:"desc"}}}});return new Response(JSON.stringify(p.paginated(A,{page:h,limit:x,total:b})),{status:200,headers:{"Content-Type":"application/json","X-RateLimit-Limit":"10","X-RateLimit-Remaining":r.remaining?.toString()||"0","X-RateLimit-Reset":(Math.floor(Date.now()/1e3)+60).toString()}})}catch(e){if(console.error("Error in GET /api/partnerships:",e),e instanceof u)return new Response(JSON.stringify({success:!1,error:e.message,details:e.details,requestId:crypto.randomUUID()}),{status:e.status,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}});return new Response(JSON.stringify({success:!1,error:"Internal Server Error",requestId:crypto.randomUUID()}),{status:500,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}})}};async function R(e){try{let t=e.headers.get("x-forwarded-for"),s=t?t.split(/, /)[0]:"127.0.0.1",r=y(s,5);if(!r.success)return new Response(JSON.stringify({error:"Too many requests",message:r.error||"Rate limit exceeded",retryAfter:r.retryAfter}),{status:429,headers:{"Content-Type":"application/json","Retry-After":r.retryAfter?.toString()||"60","X-RateLimit-Limit":"5","X-RateLimit-Remaining":r.remaining?.toString()||"0","X-RateLimit-Reset":(Math.floor(Date.now()/1e3)+(r.retryAfter||60)).toString()}});let a=await e.json(),n=h.safeParse(a);if(!n.success)return new Response(JSON.stringify({success:!1,error:"Validation failed",details:n.error.flatten()}),{status:400,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}});let i=n.data;try{let e=await m.z.$transaction(async e=>{let t=await e.user.upsert({where:{email:"system@theramplc.com"},update:{},create:{name:"System",email:"system@theramplc.com",role:"ADMIN",active:!1}});return await e.partnershipApplication.create({data:{fullName:i.fullName,email:i.email,company:i.company,phone:i.phone,country:i.country,businessType:i.businessType,expertise:i.expertise,message:i.message,status:"NEW",statusHistory:{create:{previousStatus:null,newStatus:"NEW",userId:t.id,notes:"Application submitted"}}},include:{statusHistory:{include:{changedBy:{select:{id:!0,name:!0,email:!0}}},orderBy:{changedAt:"desc"},take:1}}})});return new Response(JSON.stringify({success:!0,data:e,message:"Application submitted successfully"}),{status:201,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}})}catch(e){return console.error("Database error creating application:",e),new Response(JSON.stringify({success:!1,error:"Failed to create application",requestId:crypto.randomUUID()}),{status:500,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}})}}catch(e){if(console.error("Unexpected error in POST /api/partnerships:",e),e instanceof o.z.ZodError)return new Response(JSON.stringify({success:!1,error:"Invalid request data",details:e.flatten()}),{status:400,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}});return new Response(JSON.stringify({success:!1,error:"Internal server error",requestId:crypto.randomUUID()}),{status:500,headers:{"Content-Type":"application/json","X-Request-ID":crypto.randomUUID()}})}}let x=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/partnerships/route",pathname:"/api/partnerships",filename:"route",bundlePath:"app/api/partnerships/route"},resolvedPagePath:"/Users/mulsewsmba/Downloads/the.RAM.plc/app/api/partnerships/route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:w,workUnitAsyncStorage:b,serverHooks:A}=x;function I(){return(0,i.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:b})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79464:(e,t,s)=>{"use strict";s.d(t,{z:()=>a});var r=s(96330);let a=global.prisma||new r.PrismaClient({log:["error"]})},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},96559:(e,t,s)=>{"use strict";e.exports=s(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[719,697],()=>s(6377));module.exports=r})();